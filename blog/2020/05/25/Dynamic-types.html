<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Dynamic types</title>

    <link rel="stylesheet" type="text/css"  href="/css/site.css" media="screen" />
    <link rel="stylesheet" type="text/css"  href="/css/tables.css" media="screen" />
    <link title="RSS feed for rsdoiel's blog" rel="alternate" type="application/rss+xml" href="http://rsdoiel.github.io/rss.xml" />
    <link rel="alternative" type="application/markdown" href="Dynamic-types.md">
  </head>
  <body>
    <nav>
    <ul>
    <li>
    <a href="/">R. S. Doiel</a>
    </li>
    <li>
    <a href="/blog/">Blog</a>
    </li>
    <li>
    <a href="/presentations.html">Presentations</a>
    </li>
    <li>
    <a href="/library-terminology.html">Library Jargon</a>
    </li>
    <li>
    <a href="/cv.html">CV</a>
    </li>
    <li>
    <a href="/resume.html">Resume</a>
    </li>
    <li>
    <a href="https://github.com/rsdoiel">GitHub</a>
    </li>
    </ul>
    </nav>

    <section>
      <article>
	  <h1>
   Dynamic types
   </h1>
   <p>
   By R. S. Doiel, 2020-05-25
   </p>
   <p>
   This is the eighth post in the <a href="../../04/11/Mostly-Oberon.html">Mostly Oberon</a> series. Mostly Oberon documents my exploration of the Oberon Language, Oberon System and the various rabbit holes I will inevitably fall into.
   </p>
   <h2>
   Dynamic Types in Oberon
   </h2>
   <p>
   Oberon-7 is a succinct systems language. It provides a minimal but useful set of basic static types. Relying on them addresses many common programming needs. The Oberon compiler ensures static types are efficiently allocated in memory. One of the strengths of Oberon is this ability to extend the type system. This means when the basic types fall short you can take advantage of Oberon’s type extension features. This includes creating dynamically allocated data structures. In Oberon-7 combining Oberon’s <code>POINTER TO</code> and <code>RECORD</code> types allows us to create complex and dynamic data structures.
   </p>
   <h2>
   An example, dynamic strings
   </h2>
   <p>
   Strings in Oberon-7 are typical declared as an <code>ARRAY OF CHAR</code> with a specific length. If the length of a string is not known a head of time this presents a challenge. One approach is to declare a long array but that would allocate allot of memory which may not get used. Another approach is to create a dynamic data structure. An example is using a linked list of shorter <code>ARRAY OF CHAR</code>. The small fixed strings can combine to represent much larger strings. When one fills up we add another.
   </p>
   <h3>
   Pointers and records, an Oberon idiom
   </h3>
   <p>
   Our data model is a pointer to a record where the record contains an <code>ARRAY OF CHAR</code> and a pointer to the next record. A common idiom in Oberon for dynamic types is to declare a <code>POINTER TO</code> type and declare a <code>RECORD</code> type which contains the <code>POINTER TO</code> type as an attribute. If you see this idiom you are looking at some sort of dynamic data structure. The pointer type is usually named for the dynamic type you want work with and the record type is declared using the same name with a “Desc” suffix. In our case <code>DynamicString</code> will be the name of our <code>POINTER TO</code> type and our record type will be called <code>DynamicStringDesc</code> following the convention. In our record structure we include a “value” to holding a short fixed length <code>ARRAY OF CHAR</code> and a “next” to holding the pointer to our next record.
   </p>
   <p>
   In our record the value is declared as a static type. We need to know how long our “short” string should be? I.e. What length is our <code>ARRAY OF CHAR</code>? It’s a question of tuning. If it is too short we spend more time allocating new records, too long and we are wasting memory in each record. A way to make tuning a little simpler is to use a constant value to describe our array length. Then if we decide our array is too big or too small we can adjust the constant knowing that our record structure and the procedures that use that the length information will continue to work correctly.
   </p>
   <p>
   Let’s take a look at actual code (NOTE: vSize is our constant value).
   </p>
   <pre class="Oberon"><code>    CONST
         vSize = 128; 
       
       TYPE
         DynamicString* = POINTER TO DynamicStringDesc;
         DynamicStringDesc* = RECORD 
           value : ARRAY vSize OF CHAR; 
           next : DymamicString; 
         END;
   </code></pre>
   <p>
   NOTE: Both <code>DynamicString</code> and <code>DynamicStringDesc</code> are defined using an <code>*</code>. These are public[^asterisk] and will be available to other modules. Inside our record <code>DynamicStringDesc</code> we have two private to our module attributes, <code>.value</code> and <code>.next</code>. They are private so that we can change our implementation in the future without requiring changes in modules that use our dynamic strings. Likewise our constant <code>vSize</code> is private as that is an internal implementation detail. This practice is called information hiding[^information-hiding]
   </p>
   <p>
      </article>
    </section>

    <footer>
    <p>
    copyright © 2016 - 2020 R. S. Doiel<br /> <a href="/rssfeed.html">RSS</a> feed and website built with <a href="https://caltechlibrary.github.io/mkpage">mkpage</a>, <a href="https://caltechlibrary.github.io/datatools">datatools</a>, Bash and Make.
    </p>
    </footer>
<!-- START: PrettyFi from https://github.com/google/code-prettify -->
<script>
/* We want to add the class "prettyprint" to all the pre elements */
var pre_list = document.querySelectorAll("pre");

pre_list.forEach(function(elem) {
    elem.classList.add("prettyprint");
    elem.classList.add("linenums");/**/
    elem.classList.add("json"); /**/
});
</script>
<style>
li.L0, li.L1, li.L2, li.L3, li.L4, li.L5, li.L6, li.L7, li.L8, li.L9
{
    color: #555;
    list-style-type: decimal;
}
</style>
<link rel="stylesheet" type="text/css" href="/css/prettify.css">
<script src="https://cdn.jsdelivr.net/gh/google/code-prettify@master/loader/run_
prettify.js"></script>
<!--  END: PrettyFi from https://github.com/google/code-prettify -->

    </body>
</html>
